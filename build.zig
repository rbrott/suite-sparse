const std = @import("std");

pub fn build(b: *std.Build) void {
    const target = b.standardTargetOptions(.{});
    const optimize = b.standardOptimizeOption(.{});

    const cholmod = b.addStaticLibrary(.{
        .name = "cholmod",
        .target = target,
        .optimize = optimize,
    });
    cholmod.addIncludePath(.{
        .path="SuiteSparse_config",
    });
    cholmod.addIncludePath(.{
        .path="CHOLMOD/Include",
    });
    cholmod.addCSourceFiles(.{
        .files = &.{
            "SuiteSparse_config/SuiteSparse_config.c",
            "CHOLMOD/Cholesky/cholmod_factorize.c",
            "CHOLMOD/Cholesky/cholmod_postorder.c",
            "CHOLMOD/Cholesky/cholmod_rowcolcounts.c",
            "CHOLMOD/Cholesky/cholmod_l_rowfac.c",
            "CHOLMOD/Cholesky/cholmod_rcond.c",
            "CHOLMOD/Cholesky/cholmod_resymbol.c",
            "CHOLMOD/Cholesky/cholmod_etree.c",
            "CHOLMOD/Cholesky/cholmod_l_solve.c",
            "CHOLMOD/Cholesky/cholmod_solve.c",
            "CHOLMOD/Cholesky/cholmod_rowfac.c",
            "CHOLMOD/Cholesky/cholmod_l_rowcolcounts.c",
            "CHOLMOD/Cholesky/cholmod_l_postorder.c",
            "CHOLMOD/Cholesky/cholmod_l_factorize.c",
            "CHOLMOD/Cholesky/cholmod_l_etree.c",
            "CHOLMOD/Cholesky/cholmod_analyze.c",
            "CHOLMOD/Cholesky/cholmod_l_spsolve.c",
            "CHOLMOD/Cholesky/cholmod_l_rcond.c",
            "CHOLMOD/Cholesky/cholmod_l_analyze.c",
            "CHOLMOD/Cholesky/cholmod_spsolve.c",
            "CHOLMOD/Cholesky/cholmod_l_resymbol.c",
            "CHOLMOD/Utility/cholmod_l_hypot.c",
            "CHOLMOD/Utility/cholmod_l_aat.c",
            "CHOLMOD/Utility/cholmod_defaults.c",
            "CHOLMOD/Utility/cholmod_xtype.c",
            "CHOLMOD/Utility/cholmod_l_transpose_unsym.c",
            "CHOLMOD/Utility/cholmod_ensure_dense.c",
            "CHOLMOD/Utility/cholmod_l_mult_size_t.c",
            "CHOLMOD/Utility/cholmod_score_comp.c",
            "CHOLMOD/Utility/cholmod_l_sbound.c",
            "CHOLMOD/Utility/cholmod_l_dense_to_sparse.c",
            "CHOLMOD/Utility/cholmod_allocate_triplet.c",
            "CHOLMOD/Utility/cholmod_l_copy_triplet.c",
            "CHOLMOD/Utility/cholmod_set_empty.c",
            "CHOLMOD/Utility/cholmod_dbound.c",
            "CHOLMOD/Utility/cholmod_sort.c",
            "CHOLMOD/Utility/cholmod_allocate_factor.c",
            "CHOLMOD/Utility/cholmod_realloc_multiple.c",
            "CHOLMOD/Utility/cholmod_l_reallocate_column.c",
            "CHOLMOD/Utility/cholmod_l_start.c",
            "CHOLMOD/Utility/cholmod_allocate_dense.c",
            "CHOLMOD/Utility/cholmod_l_alloc_work.c",
            "CHOLMOD/Utility/cholmod_nnz.c",
            "CHOLMOD/Utility/cholmod_reallocate_triplet.c",
            "CHOLMOD/Utility/cholmod_reallocate_column.c",
            "CHOLMOD/Utility/cholmod_l_copy_dense.c",
            "CHOLMOD/Utility/cholmod_add.c",
            "CHOLMOD/Utility/cholmod_change_factor.c",
            "CHOLMOD/Utility/cholmod_reallocate_factor.c",
            "CHOLMOD/Utility/cholmod_copy.c",
            "CHOLMOD/Utility/cholmod_allocate_work.c",
            "CHOLMOD/Utility/cholmod_l_free_work.c",
            "CHOLMOD/Utility/cholmod_l_copy_dense2.c",
            "CHOLMOD/Utility/cholmod_l_reallocate_factor.c",
            "CHOLMOD/Utility/cholmod_pack_factor.c",
            "CHOLMOD/Utility/cholmod_l_ones.c",
            "CHOLMOD/Utility/cholmod_l_dense_nnz.c",
            "CHOLMOD/Utility/cholmod_l_calloc.c",
            "CHOLMOD/Utility/cholmod_mult_uint64_t.c",
            "CHOLMOD/Utility/cholmod_alloc_factor.c",
            "CHOLMOD/Utility/cholmod_l_free_triplet.c",
            "CHOLMOD/Utility/cholmod_transpose.c",
            "CHOLMOD/Utility/cholmod_copy_dense.c",
            "CHOLMOD/Utility/cholmod_l_allocate_dense.c",
            "CHOLMOD/Utility/cholmod_l_allocate_triplet.c",
            "CHOLMOD/Utility/cholmod_l_eye.c",
            "CHOLMOD/Utility/cholmod_copy_dense2.c",
            "CHOLMOD/Utility/cholmod_l_change_factor.c",
            "CHOLMOD/Utility/cholmod_l_pack_factor.c",
            "CHOLMOD/Utility/cholmod_alloc_work.c",
            "CHOLMOD/Utility/cholmod_l_finish.c",
            "CHOLMOD/Utility/cholmod_allocate_sparse.c",
            "CHOLMOD/Utility/cholmod_l_error.c",
            "CHOLMOD/Utility/cholmod_l_realloc_multiple.c",
            "CHOLMOD/Utility/cholmod_l_allocate_work.c",
            "CHOLMOD/Utility/cholmod_l_band_nnz.c",
            "CHOLMOD/Utility/cholmod_speye.c",
            "CHOLMOD/Utility/cholmod_mult_size_t.c",
            "CHOLMOD/Utility/cholmod_l_zeros.c",
            "CHOLMOD/Utility/cholmod_l_free.c",
            "CHOLMOD/Utility/cholmod_cumsum.c",
            "CHOLMOD/Utility/cholmod_l_score_comp.c",
            "CHOLMOD/Utility/cholmod_l_reallocate_sparse.c",
            "CHOLMOD/Utility/cholmod_l_malloc.c",
            "CHOLMOD/Utility/cholmod_l_band.c",
            "CHOLMOD/Utility/cholmod_reallocate_sparse.c",
            "CHOLMOD/Utility/cholmod_sparse_to_dense.c",
            "CHOLMOD/Utility/cholmod_maxrank.c",
            "CHOLMOD/Utility/cholmod_dense_nnz.c",
            "CHOLMOD/Utility/cholmod_transpose_unsym.c",
            "CHOLMOD/Utility/cholmod_realloc.c",
            "CHOLMOD/Utility/cholmod_free_work.c",
            "CHOLMOD/Utility/cholmod_l_add.c",
            "CHOLMOD/Utility/cholmod_copy_factor.c",
            "CHOLMOD/Utility/cholmod_sparse_to_triplet.c",
            "CHOLMOD/Utility/cholmod_l_factor_to_sparse.c",
            "CHOLMOD/Utility/cholmod_band_nnz.c",
            "CHOLMOD/Utility/cholmod_l_divcomplex.c",
            "CHOLMOD/Utility/cholmod_l_sparse_to_triplet.c",
            "CHOLMOD/Utility/cholmod_zeros.c",
            "CHOLMOD/Utility/cholmod_l_triplet_to_sparse.c",
            "CHOLMOD/Utility/cholmod_l_version.c",
            "CHOLMOD/Utility/cholmod_transpose_sym.c",
            "CHOLMOD/Utility/cholmod_l_speye.c",
            "CHOLMOD/Utility/cholmod_ones.c",
            "CHOLMOD/Utility/cholmod_ptranspose.c",
            "CHOLMOD/Utility/cholmod_l_allocate_factor.c",
            "CHOLMOD/Utility/cholmod_free_sparse.c",
            "CHOLMOD/Utility/cholmod_triplet_to_sparse.c",
            "CHOLMOD/Utility/cholmod_l_nnz.c",
            "CHOLMOD/Utility/cholmod_l_copy.c",
            "CHOLMOD/Utility/cholmod_dense_to_sparse.c",
            "CHOLMOD/Utility/cholmod_version.c",
            "CHOLMOD/Utility/cholmod_clear_flag.c",
            "CHOLMOD/Utility/cholmod_l_copy_sparse.c",
            "CHOLMOD/Utility/cholmod_l_set_empty.c",
            "CHOLMOD/Utility/cholmod_l_add_size_t.c",
            "CHOLMOD/Utility/cholmod_error.c",
            "CHOLMOD/Utility/cholmod_l_ensure_dense.c",
            "CHOLMOD/Utility/cholmod_l_sort.c",
            "CHOLMOD/Utility/cholmod_l_realloc.c",
            "CHOLMOD/Utility/cholmod_copy_triplet.c",
            "CHOLMOD/Utility/cholmod_l_maxrank.c",
            "CHOLMOD/Utility/cholmod_aat.c",
            "CHOLMOD/Utility/cholmod_l_dbound.c",
            "CHOLMOD/Utility/cholmod_free_dense.c",
            "CHOLMOD/Utility/cholmod_l_free_factor.c",
            "CHOLMOD/Utility/cholmod_sbound.c",
            "CHOLMOD/Utility/cholmod_memdebug.c",
            "CHOLMOD/Utility/cholmod_l_cumsum.c",
            "CHOLMOD/Utility/cholmod_l_free_dense.c",
            "CHOLMOD/Utility/cholmod_l_spzeros.c",
            "CHOLMOD/Utility/cholmod_free.c",
            "CHOLMOD/Utility/cholmod_copy_sparse.c",
            "CHOLMOD/Utility/cholmod_factor_to_sparse.c",
            "CHOLMOD/Utility/cholmod_add_size_t.c",
            "CHOLMOD/Utility/cholmod_free_factor.c",
            "CHOLMOD/Utility/cholmod_start.c",
            "CHOLMOD/Utility/cholmod_malloc.c",
            "CHOLMOD/Utility/cholmod_l_allocate_sparse.c",
            "CHOLMOD/Utility/cholmod_l_clear_flag.c",
            "CHOLMOD/Utility/cholmod_band.c",
            "CHOLMOD/Utility/cholmod_free_triplet.c",
            "CHOLMOD/Utility/cholmod_l_alloc_factor.c",
            "CHOLMOD/Utility/cholmod_eye.c",
            "CHOLMOD/Utility/cholmod_l_defaults.c",
            "CHOLMOD/Utility/cholmod_calloc.c",
            "CHOLMOD/Utility/cholmod_l_ptranspose.c",
            "CHOLMOD/Utility/cholmod_l_copy_factor.c",
            "CHOLMOD/Utility/cholmod_l_reallocate_triplet.c",
            "CHOLMOD/Utility/cholmod_l_free_sparse.c",
            "CHOLMOD/Utility/cholmod_divcomplex.c",
            "CHOLMOD/Utility/cholmod_spzeros.c",
            "CHOLMOD/Utility/cholmod_l_transpose_sym.c",
            "CHOLMOD/Utility/cholmod_l_transpose.c",
            "CHOLMOD/Utility/cholmod_hypot.c",
            "CHOLMOD/Utility/cholmod_l_sparse_to_dense.c",
            "CHOLMOD/Utility/cholmod_finish.c",
            "CHOLMOD/Utility/cholmod_l_xtype.c",
        },
        .flags = &.{
            "-DNCHECK",
            "-DNPARTITION",
            "-DNCAMD",
            "-DNMATRIXOPS",
            "-DNMODIFY",
            "-DNSUPERNODAL",
            "-DNPRINT",
        },
    });

    b.installArtifact(cholmod);
}
